<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href = "https://ifh.cc/g/nN9xc5.png">
  <title>ì„±ë‚¨.ai : ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”</title>
</head>
<body>

<style>
*{
  box-sizing:border-box;
}


@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.bigAlarm{
  width:100vw;
  height:100vh;
  background:#00000040;
  backdrop-filter: blur(2px);
  position: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999999;
  top:0;left:0;
  transition:all 0.5s ease;
  font-size: 0.9rem;
}

.bigAlarm .title{font-size:1.2rem;margin-bottom: 10px;font-weight: 750;}

.bigAlarm > div{
  width: 80%;
  max-width: 380px;
  min-width: 285px;
  height:fit-content;
  max-height: 300px;
  border-radius: 20px;
  background-color: white;
  padding: 20px;
  position:relative;flex-direction: column;
  display: flex;align-items: center;justify-content: center;
}
.bigAlarm div > div{opacity:0.8;margin-top:5px;}

.bigAlarm > div > article{
  width: 100%;display:flex;gap:4%;margin-top:30px;
  justify-content: center;align-items: center;
}

.bigAlarm > div > article button{
  width: 45%;border-radius: 100px;
  padding:12px 25px !important;
}

textarea{
  border:none;
  outline:none;
  font-size:0.9rem;
  overflow:hidden;
  background:transparent;
}

body{
  font-size:16px;
  letter-spacing:1.5px;
  font-family: ë‚˜ëˆ”ìŠ¤í€˜ì–´;
  margin:0;
  padding:0;
  width:100vw;
  height:100vh;
  height: 100dvh;
  background:#000000;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow: hidden;
}

body > section{
  width:100%;
  height:100vh;
  height: 100dvh;
  /*max-width:400px;*/
  position:relative;
  background:#f2f2f3;
}

header{
  width:100%;
  height:50px;
  display:flex;
  background:white;
  border-color:transparent;
}

header{
  position:absolute;
  top:0px;
  left:0px;
  z-index:99999;
  display:flex;
  align-items:center;
  /*border-bottom:1px solid;*/
}

#logo{
  height: 75%;
  margin-left: 15px;
}

#sideUp{
  height: 50%;
  margin-left: auto;
  margin-right: 15px;
  transition:all 0.5s ease;border-radius: 50%;
}

#sideUp:hover{
  height: 70%;
  padding:5px;
  padding:5px;
  margin-right: 10px;
  background:#00000020;
}

aside {
  width: 90%;
  display: flex;
  padding: 3.5px 5px;
  height: fit-content;
  align-items: center; 
  min-height: 40px;
  max-height: 200px;
  position: absolute;
  left: 50%;
  bottom: 25px;
  z-index: 99999;
  background: #FFFFFF;
  border-radius: 25px;
  transform: translateX(-50%);
  box-shadow: 0 5px 8px #00000015, inset -2px -2px 2px #00000009;
  /*border: 1px solid #eaeaeaAA;*/
}

aside textarea {
  width: calc(100% - 60px);
  height:30px;
  min-height: 30px;
  max-height: 120px;
  padding: 5px 13px;
  font-size: 0.82rem;
  resize: none;
  border: none;
  outline: none;
  overflow: hidden;
  background: transparent;
  box-sizing: border-box;
  line-height: 1.4;
  white-space: pre-wrap;
  word-break: break-word;
}

aside > div{
  width: 40px;
  aspect-ratio: 1;
  padding: 5px;
  margin-left:auto;
  display:flex;
  align-items:center;
  margin-top:auto;
}

aside button {
  width: 100%;
  border:none;
  padding: 0px;
  aspect-ratio: 1;
  border-radius:50%;
  background:#000000;
  display:flex;
  justify-content:center;
  align-items:center;
  transition:all 0.5s ease;
}

aside button:hover{
  opacity: 0.6;
}

aside button img{
  height:55%;
  transform:rotate(90deg) scaleX(-1);
  filter:invert(1);
  margin-bottom:3px;
}

main{
  width: 100%;
  height: 100%;
  overflow: hidden;
  overflow-y:scroll;
  scrollbar-width: none;
  padding-top: 75px;
  padding-bottom: 200px;
  display:flex;
  flex-direction:column;
  align-items:center;
  -webkit-mask-image: linear-gradient(to bottom, black,black,black,black,black, transparent);
  mask-image: linear-gradient(to bottom, black,black,black,black,black, transparent);
  
}

main > section{
  width: calc(90%);
  height: fit-content;
  display:flex;
  margin: 10px;
}

main > section > div{ /*ì±„íŒ…íŒ¨ë„*/
  font-size: 0.85rem !important;
  width: fit-content;
  max-width: 80%;
  height: fit-content;
  min-height: 30px;
  border:none;
  padding: 12px 20px;
  margin-top:15px;
  background: #0000000B;
  
  /*box-shadow: 0 5px 8px #00000015, inset -2px -2px 2px #00000009;*/
}

@keyframes showChatL{
  0%{transform: translate(-400px)}
  100%{transform :none;}
}

@keyframes showChatR{
  0%{transform: translate(400px)}
  100%{transform :none;}
}

main > section > span { /*í”„ë¡œí•„ì´ë¯¸ì§€ ì»¤ë²„*/
  margin-bottom: auto;
  margin: 5px;
  margin-right: 15px;
  width: 35px;
  height: 35px;
  /*aspect-ratio: 1;*/
  border-radius: 50%;
  background:white;
  border:1px solid #00000020;
  outline:none;
  overflow:hidden;
}

main > section > span  > img{
  width: 100%;
  height: 100%;
  display: none;

}


.me{
  
}

.me > span{
  margin-right: 5px !important;
  margin-left: 15px;
}

aside textarea::-webkit-scrollbar {
  width: 0px;
  height: 0px;
}

.loading {
  animation: spin 0.8s linear infinite;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 2.5px solid #dbdbdb;
  border-top: 2.5px solid #0000008b;
  margin: 5px;
  aspect-ratio: 1;
}
.highB {
  font-family: "42dot Sans", sans-serif !important;
  color: white;
  background-color: #2d2d2d;
}
.highB:hover {
  color: white;
  background-color: #2d2d2dc5;
}
.midB {
  font-family: "42dot Sans", sans-serif !important;
  color: #6e6e6e;
  background-color: white;
  border: 1.5px solid #00000015;
}
.midB:hover {
  color: #000000bb;
  background-color: #00000005;
  border: 1.5px solid #d5d5d5;
}
button {
  font-family: "42dot Sans", sans-serif !important;
  padding: 7.5px 12.5px;
  border: none;
  font-weight: 800;
  border-radius: 10px;
  font-size: 0.95rem;
  transition: all 0.5s ease;
}

#sideUpWindow{
  width: 100vw;
  height: calc(100vh - 50px);
  position:fixed;
  top:50px;left:0;
  background:#00000010;
  backdrop-filter:blur(2px);
  z-index: 100000000;
  display:none;
}
#sideUpWindow div{
  width: 100%;
  height: 100%;
  position:relative;
}

.box{
  padding: 5px 10px;
  background: #00000010;
  border-radius: 10px;
  font-size: 0.9em;
}

</style>

<section>
<header>
  <img src="https://ifh.cc/g/nN9xc5.png" id = "logo"/>
  <span style = "margin-left:5px;font-weight:bold;">ì„±ë‚¨.ai</span>
  <span style = "margin-left:5px;opacity:0.3;font-size:0.8em;font-weight:bold;height:100%;display:flex;align-items:center;padding-top:2.5px;"> : ì§„ë¡œ â€¢ ì·¨ì—… â€¢ ì •ì±… ìƒë‹´</span>
  <img src="https://ifh.cc/g/8SYcDo.png" id = "sideUp" onclick = "aboutMe();">
</header>
<main>
  
</main>
<aside>
  <textarea placeholder="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”" autofocus ></textarea>
  <div><button><img src="https://ifh.cc/g/lNXYYf.png"/></button></div>
</aside>
</section>
<div id = "sideUpWindow"></div>
<div style = "position:absolute;bottom: 5px; opacity: 0.5; width: 100vw;display:flex;justify-content:center;font-size: 12px;">ì„±ë‚¨.ai ëŠ” ê°™ì€ë§ì„ ë°˜ë³µí•  ìˆ˜ ìˆì–´ìš”. ì´ì  ì–‘í•´ ë¶€íƒë“œë ¤ìš”</div>
<script>
let EfetchWaiter = true
let EfetchTimeWaiter = true;
let username = 'ì‚¬ìš©ì'
let context = 'ì•„ì§ ë§¥ë½ì—†ìŒ'
let before = 'aiê°€ ì‚¬ìš©ìì—ê²Œ ìµœì´ˆë¡œ, ì¸ì‚¬ ë° ìê¸°ì†Œê°œë¥¼ ì™„ë£Œí•˜ê³  ì—´ì‹¬íˆ ë‹µë³€í•˜ê² ë‹¤í•¨'
//ìœ í‹¸ë¦¬í‹°
const $ = (n) => document.querySelector(n);
async function typeText(name, content, speed=30) {
      const element = $(name);
      if (!element) {
        console.error(`${name}ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        return;
      }
      const scroll = setInterval(()=>{scrollTo()},500)
      let processedContent = '';
      let index = 0;

      while (index < content.length) {
        const char = content[index];

        if (char === '<') {
          processedContent += char;
          index++;
          while (content[index] !== '>' && index < content.length) {
            processedContent += content[index];
            index++;
          }
          processedContent += '>';
        } else {
          processedContent += char;
        }

        element.innerHTML = processedContent + 'â—'; 
        if (content[index] !== ' ') {
          await new Promise((resolve) => setTimeout(resolve, speed));
        }

        index++;
      }
      element.innerHTML = processedContent;
      return  clearInterval(scroll)
    }


async function Efetch(path, headers = {}, body = null, print = (typeof test !== 'undefined'?test:false), delay = 100) {
await wait(()=>EfetchWaiter)
if (!EfetchTimeWaiter) return clearInverval(scroll);
EfetchWaiter = false;
EfetchTimeWaiter = false;

try {
  const isPost = !!body;

  if (isPost && !headers["Content-Type"]) {
    headers["Content-Type"] = "application/json";
  }

  const res = await fetch('/' + path, {
    method: isPost ? 'POST' : 'GET',
    headers,
    body: isPost ? JSON.stringify(body) : null,
  });
  if(res.status === 429)return alarm('ì›Œì›Œ, ì¡°ê¸ˆ ì²œì²œíˆ í•´ì£¼ì„¸ìš”')

  const data = await res.json();
  if (print) console.log(`/${path} res:`, data);
  return data;

} catch (error) {
  console.error(`/${path} res ERROR:`, error);
  return null;
} finally {
  setTimeout(() => {
    EfetchTimeWaiter = true;
    EfetchWaiter = true;
  }, delay);
}
}

function wait(b) {
return new Promise((resolve) => {
  const check = () => {
    if (b()) return resolve();
    setTimeout(check, 30);
  };
  check();
});
}

function scrollTo(){
  document.querySelector('main').scrollTo({
top: document.querySelector('main').scrollHeight,
behavior: 'smooth'
});
}

function random(min, max) {
  const time = Date.now();
  let seed = time ^ (time >> 3);
  seed = (seed * 9301 + 49297) % 233280;
  const randomValue = seed / 233280 + Math.random();
  return Math.floor((randomValue % 1) * (max - min + 1)) + min;
}

function textEF(content) {
  return content
    .replace(/@[^@\s]{1,30}(?=\s|$)/g, m => `<span class='mention'>${m}</span>`)
    .replace(/(https?:\/\/[^\s]+|www\.[^\s]+)/g, m => 
      m.includes("i.ibb") ? m :
      `<span><a href="${m}" ${m.includes(location.origin)?'':`target="_blank"`} class="link">${m}</a></span>`
    )
    .replace(/__(.+?)__/gs, (_, p1) => `<span style='text-decoration: underline;'>${p1}</span>`)
    .replace(/\*\*([\s\S]*?)\*\*/g, (_, p1) => `<span style='font-weight:940;'>${p1}</span>`)
    .replace(/~~([\s\S]*?)~~/g, (_, p1) => `<span style='text-decoration: line-through;'>${p1}</span>`)
    .replace(/--([\s\S]*?)--/g, (_, p1) => `<span style='background-color:rgba(255,219,101,0.69);border-radius:5px;padding:2px;color:black;'>${p1}</span>`)
    .replace(/#([\s\S]*?)#/g, (_, p1) => `<span style="font-size:1.3em;">${p1}</span>`)
    .replaceAll("$br$", "<br>")
    .replaceAll("$sp$", "");
}


let aiLimit = true;
async function fetchAI(input, log) {
  if (!aiLimit) return "timeLimit";
  aiLimit = false;
  let r = await Efetch('ai',undefined,{data:{content:input,context:context,before:before,username:username}},false)
  aiLimit = true
  return r;
}

function makeChat(content, who='ai', animate=true) {
  const chat = document.createElement('section');
  const id = 'chat-' + Date.now().toString(36);
  const prof = `<span><img src="${who=='ai'?'https://ifh.cc/g/LQ0VPG.png':'https://ifh.cc/g/cdXtco.png'}" style="display:block;"/></span>`;
  const bubble = `<div class="bubble" style="border-radius:${who==='ai'?'2px 20px 20px 20px':'20px 2px 20px 20px;margin-left:auto;'}">${textEF(content)}</div>`;
  chat.innerHTML = who==='ai' ? `${prof}${bubble}` : `${bubble}${prof}`;
  chat.className = who;
  chat.id = id;
  if (animate) chat.style.animation = `showChat${who==='ai'?'L':'R'} 1s ease`;
  $('main').appendChild(chat);
  scrollTo()
  return id;
}

//modal Alarm
function bigAlarm(content, buttons = ['í™•ì¸', 'ì·¨ì†Œ'], callback = () => {}) {
const id = Date.now().toString(36);
if (typeof content !== 'object') content = ['', content];

const close = () => {
  const modal = document.getElementById(`al${id}`);
  if (!modal) return;
  const buttons = modal.querySelectorAll('button');
  buttons.forEach(btn => btn.style.pointerEvents = 'none');
  modal.style.opacity = '0';
  setTimeout(() => modal.remove(), 500);
};

const modal = document.createElement('div');
modal.className = 'bigAlarm';
modal.id = `al${id}`;
modal.innerHTML = `
  <div>
    ${content[0] ? `<div class="title">${textEF(content[0])}</div>` : ''}
    <div${!content[0] ? ' style="font-size:1rem;opacity:1"' : ''}>${textEF(content[1])}</div>
    <article>
      <button class="highB" id="okBtn${id}">${textEF(buttons[0])}</button>
      <button id="cancelBtn${id}">${textEF(buttons[1])}</button>
    </article>
  </div>`;

modal.onclick = (e) => {
  if (e.target === modal) document.getElementById(`cancelBtn${id}`).click();
};
modal.querySelector('div').onclick = (e) => e.stopPropagation();

document.body.appendChild(modal);

document.getElementById(`okBtn${id}`).onclick = () => {
  close();
  callback();
};
document.getElementById(`cancelBtn${id}`).onclick = close;
}


const Storage = {
  setSession: (key, val) => sessionStorage.setItem(key, val),
  getSession: (key) => sessionStorage.getItem(key),
  setLocal: (key, val) => localStorage.setItem(key, val),
  getLocal: (key) => localStorage.getItem(key)
};

//input
let schools = {};

function initTextarea() {
  const ta = $('aside textarea');
  const phList = [
    'ì§„ë¡œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”',
    'ì„±ë‚¨ì— ì ì ˆí•œ ì§ì—…, ì§„ë¡œë¥¼ ë¬¼ì–´ë´ìš”',
    'ì–´ë–¤ ì§„ë¡œê°€ ë§ì„ì§€ ê³ ë¯¼ë˜ì‹œë‚˜ìš”?',
    'ì„±ë‚¨ì˜ ì·¨ì—…ì •ë³´ë¥¼ ì•Œì•„ë´ìš”',
    
    'ì„±ë‚¨ì‹œì— ê´€í•´ ë¬¼ì–´ë³´ì„¸ìš”!',
    'ì„±ë‚¨ì‹œëŠ” ë…¸ì¸ë¶„ë“¤ì„ ì–´ì°Œ ì§€ì›í• ê¹Œìš”?',
    'ì„±ë‚¨ì‹œì˜ ì´ˆë“±í•™êµ ê°œìˆ˜ëŠ”?',
    'ì„±ë‚¨ì‹œì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹ ê°€ìš”?',
  ];
  ta.placeholder = phList[random(0,phList.length-1)];

  ta.addEventListener('input', () => {
    ta.style.height = '30px';
    ta.style.height = Math.min(ta.scrollHeight, 120) + 'px';
  });

  ta.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) e.preventDefault();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') $('div button').click();
  });

  $('div button').onclick = async () => {//ì±„íŒ…ë°œìƒ

    let input = ta.value.trim();
    if (!input) return;
    makeChat(input, 'me');
    let chat = makeChat('<div style = "width: 100%;display:flex;justify-content:center;"><div class="loading"></div></div><div  style = "width: 100%;display:flex;justify-content:center;"> ì¶”ê°€ì •ë³´ ì¡°íšŒì¤‘</div>');
    ta.value = '';
    ta.style.height = '30px';

    // Efetch í˜¸ì¶œ ê²°ê³¼ë¥¼ resDataì— ì €ì¥
    let resData = await Efetch('ai', undefined, { data: { content: input, context: context, before: before, username: username } }, false);
    // resData.rì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  res ë³€ìˆ˜ì— í• ë‹¹
    let res = resData && resData.r;

    if (!res) {
      // ì‘ë‹µì´ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
      $(`#${chat} .bubble`).innerHTML = 'ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
      return;
    }

    let parsed;
    try {
      // ```json``` ë“± ë§ˆí¬ë‹¤ìš´ ë°±í‹± ì œê±° í›„ íŒŒì‹± ì‹œë„
      const cleanRes = res.replace(/```json\s*|```/g, '').trim();
      parsed = JSON.parse(cleanRes);
    } catch (e) {
      // íŒŒì‹± ì‹¤íŒ¨ ì‹œ, ì›ë³¸ 'res'ë¥¼ ì‘ë‹µìœ¼ë¡œ ì²˜ë¦¬
      console.error("AI ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", e);
      // 'res'ë¥¼ ì§ì ‘ ì‘ë‹µìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ê¸°ì¡´ 'context'ë¥¼ ìœ ì§€
      parsed = { ì‘ë‹µ: res, ë§¥ë½: context };
    }

    before = input;
    // íŒŒì‹±ëœ contextê°€ ìˆë‹¤ë©´ ì‚¬ìš©í•˜ê³ , ì—†ë‹¤ë©´ ê¸°ì¡´ context ìœ ì§€
    context = parsed.ë§¥ë½ || context;
    // íŒŒì‹±ëœ ì‘ë‹µì´ ìˆë‹¤ë©´ ì‚¬ìš©í•˜ê³ , ì—†ë‹¤ë©´ ì›ë³¸ 'res'ë¥¼ ì‚¬ìš©
    let answer = parsed.ì‘ë‹µ || res;
    answer = textEF(answer); // í…ìŠ¤íŠ¸ íš¨ê³¼ ì ìš©

    const schoolNameRegex = /[^\s~`!@#$%^&*()\-_=+\[\]{}\\|;:'",.<>/?]{2,}(ê³ ë“±í•™êµ|ì¤‘í•™êµ|ì´ˆë“±í•™êµ|ëŒ€í•™êµ|ëŒ€í•™)/g;

    const matchedSchools = Array.from(new Set(
      (answer.match(schoolNameRegex) || []).map(s => s.trim())
    ));

    console.log('í•™êµëª…:', matchedSchools);

    if (matchedSchools.length > 0) {
      $(`#${chat} .bubble`).innerHTML = '<div style = "width: 100%;display:flex;justify-content:center;"><div class="loading"></div></div><div  style = "width: 100%;display:flex;justify-content:center;"> ì¶”ê°€ì •ë³´ ì¡°íšŒì¤‘</div>';
      try {
        const schoolRes = await Efetch('school', {}, { schools: matchedSchools }, false);

        if (schoolRes && schoolRes.r) {
          matchedSchools.forEach(school => {
            if (school !== 'ê³¼í•™ê³ ë“±í•™êµ') {
              console.log(schools, schoolRes.r, school)
              schools[school] = schoolRes.r[school];
              const replaced = `<span style="color:blue;font-weight:bold" onclick="ss('${school}')" class = "schoolShow">${school}</span>`;
              answer = answer.replaceAll(`%${school}%`, replaced);
            }
          });
        }
      } catch (e) {
        console.error('í•™êµì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', e);
      }

      if(answer.includes('schoolShow')) answer += `<br><br>í•™êµ ì´ë¦„ì„ í´ë¦­í•˜ì‹œë©´ ë” ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•´ë“œë¦´ê»˜ìš”!`
    }

    $(`#${chat} .bubble`).innerHTML = '';
    await typeText(`#${chat}.ai .bubble`, answer.replaceAll('%','').replaceAll('\\n','<br>').replaceAll('\n','<br>'));
    scrollTo();
  }
}

// ... (ë‚˜ë¨¸ì§€ ì½”ë“œ)
//ì´ˆê¸°ì‹¤í–‰
document.addEventListener('DOMContentLoaded', () => {
    if (!Storage.getSession('newPage')) {
      bigAlarm(['ì•ˆë…•í•˜ì„¸ìš”', '**ì„±ë‚¨.ai** ëŠ” **ì¤‘ì•™ê³ ë“±í•™êµ** í•™ìƒíŒ€ìœ¼ë¡œë¶€í„° ê°œë°œëœ í˜ì´ì§€ ì…ë‹ˆë‹¤.$br$$br$ë”°ë¼ì„œ ì•„ì§ ë‹¤ì–‘í•œ ë°©ë©´ì—ì„œ ë¶€ì¡±í•  ìˆ˜ ìˆìŒ ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.']);
      Storage.setSession('newPage', false);
    }
  
    makeChat(`ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì„±ë‚¨ì‹œ ì‹œë¯¼ë“¤ì„ ìœ„í•˜ì—¬ ë§Œë“¤ì–´ì§„ **ì„±ë‚¨.ai** ì…ë‹ˆë‹¤!ğŸ˜„<br> ì„±ë‚¨ì‹œì— ê´€í•œ ì§ˆë¬¸ì´ë‚˜ ì§„ë¡œ/ì·¨ì—…ì— ê´€ë ¨ëœ êµ¼ê¸ˆì¦ì„ í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”! ë‹¹ì‹ ì—ê²Œ ì¡°ê¸ˆì´ë¼ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆëŠ” ë‹µë³€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤! $br$$br$ <div style = "color:blue" onclick = '$("#sideUp").click()'>ê°œë°œìì— ëŒ€í•˜ì—¬</div>`, undefined, false);
    makeChat(`ìì£¼ í•˜ëŠ” ì§ˆë¬¸ <br> 
    <br><div class = "box" onclick = "$('textarea').value += this.innerText">ë‚˜ëŠ” ì¤‘í•™ìƒì¸ë°, ê³¼í•™ ì¤‘ì  í•™êµëŠ” ì–´ë””ì–´ë””ê°€ ìˆì„ê¹Œ?</div>
    <br><div class = "box" onclick = "$('textarea').value += this.innerText">ë‚˜ëŠ” ê³ ë“±í•™ìƒì¸ë°, ìš°ë¦¬ ì§€ì—­ì— ë‚˜ì˜ ì§„ë¡œì— ë§ëŠ” ì¼ìë¦¬ê°€ ìˆì„ê¹Œ?</div>
    <br><div class = "box" onclick = "$('textarea').value += this.innerText">ë‚˜ëŠ” ì„±ì¸ì´ì•¼. í˜¹ì‹œ ìš°ë¦¬ ì§€ì—­ì— ë‚´ ë¶„ì•¼ì— ë§ëŠ” ì¼ìì´ê°€ ìˆì„ê¹Œ?</div>
    <br><div class = "box" onclick = "$('textarea').value += this.innerText">ìš°ë¦¬ì§€ì—­ì—ëŠ” ë¬´ìŠ¨ ì´ˆë“±í•™êµê°€ ìˆì„ê¹Œ?</div>
    <br><div class = "box" onclick = "$('textarea').value += this.innerText">ì„±ë‚¨ì‹œì˜ ìœ ëª…í•œ ê¸°ì—… ëª©ë¡ì„ ì•Œë ¤ì¤˜</div>
    `, undefined, false);
    
    initTextarea();
  });

function useSchoolInfo(obj){
let orgObj = obj
obj = schools[obj.replaceAll('$sp$','')]
if (obj == null) return orgObj
let r = '';
r+=`#${insertSpAt(obj.SCHUL_NM)}#$br$$br$`;
r+=`**ì†Œì† êµìœ¡ì²­ : ** ${obj.ATPT_OFCDC_SC_NM||'ì •ë³´ì—†ìŒ'}$br$`;
r+=`**ê³µí•™ ì—¬ë¶€ : ** ${obj.COEDU_SC_NM||'ì •ë³´ì—†ìŒ'}$br$`;
r+=`**í•™êµ ìœ í˜• : ** ${obj.FOND_SC_NM||'ì •ë³´ì—†ìŒ'}$br$`;
r+=`**í•™êµ ì¢…ë¥˜ : ** ${obj.HS_SC_NM||'ì •ë³´ì—†ìŒ'}$br$$br$`;
r+=`**ë¬¸ì˜ ì „í™” : ** ${obj.ORG_TELNO||'ì •ë³´ì—†ìŒ'}$br$`;
r+=`**í™ˆí˜ì´ì§€ : ** ${obj.HMPG_ADRES||'ì •ë³´ì—†ìŒ'}$br$`;
return r;
}

function insertSpAt(str) {
  const pos = Math.floor(Math.random() * (str.length));
  return str.slice(0, pos) + '$sp$' + str.slice(pos);
}

function ss(s){
  makeChat(`ë”ìš± ì •í™•í•œ í•™êµ ì •ë³´ë¥¼ ì•Œì•„ë´¤ì–´ìš” : $br$ ${useSchoolInfo(s)}`)
}

function aboutMe(){
  makeChat(`
  #ì¤‘ì•™ê³ ë“±í•™êµ 1í•™ë…„ 9ë°˜ í•™ìƒíŒ€#$br$$br$
  **ìë£Œì¡°ì‚¬ ë° ê³„íš** : $br$__10913ê¹€ëŒ€ì€__$br$__10923ì´ì¤€ìš°__$br$$br$
  **í”Œë«í¼ ê°œë°œ** : $br$__10923ì´ì¤€ìš°__$br$
  (ëª¨ë“  ì½”ë“œ ë° ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  í”Œë«í¼ì„ êµ¬ì¶•í•¨)$br$$br$
  --ì„±ë‚¨.ai-- ëŠ” **ì œë¯¸ë‚˜ì´ API**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ai í”Œë«í¼ì…ë‹ˆë‹¤.$br$
  ì¼ì •í•œ ì •ì œë¥¼ í†µí•˜ì—¬ ì œë¯¸ë‚˜ì´ì˜ ì‘ë‹µì„ ì¡°ì •í•˜ê³ , í•´ë‹¹ ì‘ë‹µê³¼ ì™¸ë¶€ ì •ë³´ë¥¼ ì¡°í•©í•˜ì—¬$br$
  ì‚¬ìš©ìì—ê²Œ ì„±ë‚¨ì‹œì— ê´€í•œ ìƒë‹´ì„ ì§„í–‰í•˜ëŠ” ê²ƒì„ ëª©ì ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  `)
}
</script>

</body>
</html>

<!--
// ë‚˜ì´ìŠ¤ API ì¸ì¦í‚¤ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ (ì›ë³¸ ì½”ë“œì˜ ë¡œì§ ìœ ì§€)
function getNeisApiKey() {
  const $miz = { '$3$dlf': 0, '$3$dl': 1, '$3$tka': 2 };
  const $mizep = [0, 1, 2];
  const $fsts = ['b7bd', 'c46321', '98429696a'];
  return (
    $fsts[$miz[Object.keys($miz)[$mizep[0]]]] +
    $fsts[$miz[Object.keys($miz)[$mizep[1]]]] +
    $fsts[$miz[Object.keys($miz)[$mizep[2]]]] +
    'ab2a82ce6087c'
  );
}

/**
 * ë‚˜ì´ìŠ¤ APIë¥¼ í˜¸ì¶œí•˜ì—¬ í•™êµ ê¸°ë³¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
 * @param {string} schoolName ì¡°íšŒí•  í•™êµì˜ ì „ì²´ ëª…ì¹­
 * @returns {Promise<Object|null>} í•™êµ ìƒì„¸ ì •ë³´ ê°ì²´ (API ì‘ë‹µì˜ ëª¨ë“  í•„ë“œ í¬í•¨) ë˜ëŠ” null (í•™êµë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ)
 */
async function fetchSchoolInfo(schoolName) {
  const apiKey = getNeisApiKey();
  const apiUrl = `https://open.neis.go.kr/hub/schoolInfo`;
  const params = new URLSearchParams({
    KEY: apiKey,
    Type: 'json',
    pIndex: 1, // ì²« í˜ì´ì§€
    pSize: 10,  // ìµœëŒ€ 10ê°œ ê²°ê³¼ (ë™ëª…ì´êµ ê°€ëŠ¥ì„± ê³ ë ¤)
    SCHUL_NM: schoolName,
  });

  try {
    const response = await fetch(`${apiUrl}?${params.toString()}`);
    const data = await response.json();

    if (data.RESULT) {
      console.warn(`í•™êµ ì •ë³´ ê²€ìƒ‰ ì‹¤íŒ¨: ${data.RESULT.MESSAGE}`);
      return null;
    }

    // schoolInfo[1].row ë°°ì—´ì—ì„œ ì²« ë²ˆì§¸ í•™êµ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜
    // ëª¨ë“  í•„ë“œë¥¼ í¬í•¨í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
    return data.schoolInfo[1].row[0];

  } catch (error) {
    console.error('í•™êµ ì •ë³´ API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    return null;
  }
}

/**
 * í•™êµ ì •ë³´ë¥¼ ì½˜ì†”ì— ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
 * @param {Object} schoolData ë‚˜ì´ìŠ¤ APIë¡œë¶€í„° ë°›ì€ í•™êµ ìƒì„¸ ì •ë³´ ê°ì²´
 */
function displaySchoolDetails(schoolData) {
  if (!schoolData) {
    console.log("í‘œì‹œí•  í•™êµ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  console.log(`\n--- ${schoolData.SCHUL_NM} ìƒì„¸ ì •ë³´ ---`);

  // ê°ì²´ì˜ ëª¨ë“  í‚¤-ê°’ì„ ìˆœíšŒí•˜ë©° ì¶œë ¥ (ê°’ì´ ì¡´ì¬í•  ë•Œë§Œ)
  for (const key in schoolData) {
    // íŠ¹ì • í•„ë“œëª…ì€ ë” ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë³€í™˜
    let displayKey = key;
    switch (key) {
      case 'ATPT_OFCDC_SC_CODE': displayKey = 'ì‹œë„êµìœ¡ì²­ ì½”ë“œ'; break;
      case 'ATPT_OFCDC_SC_NM': displayKey = 'ì‹œë„êµìœ¡ì²­ ëª…ì¹­'; break;
      case 'SD_SCHUL_CODE': displayKey = 'í‘œì¤€í•™êµ ì½”ë“œ'; break;
      case 'SCHUL_NM': displayKey = 'í•™êµ ëª…ì¹­'; break;
      case 'ENG_SCHUL_NM': displayKey = 'ì˜ë¬¸ í•™êµ ëª…ì¹­'; break;
      case 'SCHUL_KND_SC_NM': displayKey = 'í•™êµ ì¢…ë¥˜'; break;
      case 'LCTN_SC_NM': displayKey = 'ì„¤ë¦½ êµ¬ë¶„'; break;
      case 'HS_GNRL_BUSNS_SC_NM': displayKey = 'ê³ ë“±í•™êµ ì¼ë°˜/íŠ¹ì„±í™”'; break;
      case 'HS_SPSCL_CUL_DIV_NM': displayKey = 'ê³ ë“±í•™êµ íŠ¹ëª©/íŠ¹ì„±í™” ê³„ì—´'; break;
      case 'HS_SC_NM': displayKey = 'ê³ ë“±í•™êµ ìœ í˜•'; break;
      case 'INDST_SPECL_CCCCL_DIV_NM': displayKey = 'ì‚°ì—…ì²´ íŠ¹ìˆ˜í•™ê¸‰'; break;
      case 'DGHT_SC_NM': displayKey = 'ì£¼ì•¼ êµ¬ë¶„'; break;
      case 'FOND_SC_NM': displayKey = 'ì„¤ë¦½ ìœ í˜•'; break;
      case 'ORG_RDNMA': displayKey = 'ë„ë¡œëª… ì£¼ì†Œ'; break;
      case 'ORG_RDNZC': displayKey = 'ë„ë¡œëª… ìš°í¸ë²ˆí˜¸'; break;
      case 'ORG_TELNO': displayKey = 'ì „í™”ë²ˆí˜¸'; break;
      case 'ORG_FAXNO': displayKey = 'íŒ©ìŠ¤ë²ˆí˜¸'; break;
      case 'HPG_ADRES': displayKey = 'í™ˆí˜ì´ì§€ ì£¼ì†Œ'; break;
      case 'COEDU_SC_NM': displayKey = 'ë‚¨ë…€ê³µí•™ ì—¬ë¶€'; break;
      case 'FOND_YMD': displayKey = 'ê°œêµ ê¸°ë…ì¼'; break;
      case 'FOAS_MEMO': displayKey = 'ê°œêµ ê¸°ë…ì¼ ë¹„ê³ '; break;
      case 'LOAD_DTM': displayKey = 'ìë£Œ ê¸°ì¤€ì¼ì'; break;
    }

    const value = schoolData[key];
    if (value !== undefined && value !== null && value !== '') { // ê°’ì´ ìˆì„ ë•Œë§Œ ì¶œë ¥
      console.log(`  ${displayKey}: ${value}`);
    }
  }
  console.log('---------------------------------');
}


/**
 * ì‚¬ìš©ìë¡œë¶€í„° í•™êµ ëª…ì¹­ì„ ì…ë ¥ë°›ì•„ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
 */
async function getSchoolInfoFromUserInput() {
  const schoolName = prompt('í•™êµ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:');

  if (!schoolName) {
    alert('í•™êµ ì´ë¦„ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return;
  }

  console.log(`"${schoolName}" í•™êµ ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...`);
  const schoolInfo = await fetchSchoolInfo(schoolName);

  if (schoolInfo) {
    displaySchoolDetails(schoolInfo); // ìƒˆë¡œìš´ í—¬í¼ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶œë ¥
  } else {
    alert(`"${schoolName}" í•™êµë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì •í™•í•œ í•™êµ ì „ì²´ ëª…ì¹­(ì˜ˆ: "ë¶„ë‹¹ì¤‘ì•™ê³ ë“±í•™êµ")ì„ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`);
    console.error(`"${schoolName}" í•™êµ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
  }
}

// í•¨ìˆ˜ í˜¸ì¶œ: ì›¹ í˜ì´ì§€ ë¡œë“œ ì‹œ ë˜ëŠ” íŠ¹ì • ì´ë²¤íŠ¸ ë°œìƒ ì‹œ í˜¸ì¶œ
getSchoolInfoFromUserInput();


-->
